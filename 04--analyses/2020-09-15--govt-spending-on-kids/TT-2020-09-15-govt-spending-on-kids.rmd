---
title: 'Tidy Tuesday 2020-09-15: Government Spending on Kids'
author: 'Leo Williams'
date: |
  | Created 2020-12-04
  | Updated: `r format(Sys.time(), "%Y %m_%b %d")`
output: 
  html_notebook: 
    toc: yes
    toc_float: yes
params:
  in_data: "submodules/tidytuesday/data/2020/2020-09-15/kids.csv"
---

# About

This document is a follow-along to the live Tidy Tuesday coding/analysis by David Robinson found here: [Tidy Tuesday live screencast: Analyzing government spending on kids in R](https://www.youtube.com/watch?v=dHRPrVsnNwo)

# Setup

```{r setup, message=FALSE}
# Load packages ----
library(knitr)
library(tidyverse)
library(tidytuesdayR)
library(scales)

# Set working dir for setup chunk ----
setwd(rprojroot::find_rstudio_root_file())
getwd()

# Set global knit options ----
opts_knit$set(
    # set project root dir as working dir
    root.dir = rprojroot::find_rstudio_root_file()
)
```

```{r other setup}
# copy tt data from submodule data/ to project data/ folder
```

# Load Data

```{r load tt data}
tt = tt_load("2020-09-15")
kids = tt$kids
```

```{r view data}
kids
```




# Explore data

```{r explore data}
# how many distinct types of variables?
kids %>%
  distinct(variable)
```

Inspect the full [variable cookbook](https://jrosen48.github.io/tidykids/articles/tidykids-codebook.html). There are a lot of variables you could analyze.

We might do:
- a choropleth (colored map by state)
- animated choropleth - showing change from 1997-2016
- what states had the fastest growing/shrinking of each of these variables

```{r}
kids %>%
  filter(variable == "PK12ed") %>% # let's just look at public spending for K-12
  distinct(state) # 50 states + DC
```

```{r}
kids %>%
  filter(variable == "PK12ed") %>% # let's just look at public spending for K-12
  distinct(year) # over 20 years
```

```{r}
kids %>%
  filter(variable == "PK12ed") %>%
  group_by(year) %>%
  summarize(total = sum(inf_adj)) %>%
  ggplot(aes(year, total)) +
  geom_line() +
  expand_limits(y = 0) +
  scale_y_continuous(labels = dollar)
```
general spending over time, but we really want to look by state.

```{r}
kids %>%
  filter(variable == "PK12ed", 
         state %in% c("New York", "Louisiana", "Arizona", "California", "Texas", "Florida", "Washington")) %>% # really want to look by state
  ggplot(aes(year, inf_adj_perchild, color = state)) +
  geom_line() +
  expand_limits(y = 0)
```
Some look to be kinda linear that we could look at them with an intercept term and how they increase over time

Lets pick 20 states at random
```{r}
kids %>%
  filter(variable == "PK12ed", 
         state %in% sample(unique(state), 20)) %>% # really want to look by state
  ggplot(aes(year, inf_adj_perchild)) + # remove color bc too many samples - replace with facet
  geom_line() +
  expand_limits(y = 0) +
  facet_wrap(~ state)
```



# Transform Data


# Analyze Data



# Session Info

```{r save session data}
# save data image
save.image(file = paste0(dir_results, "/data.Rdata"))

# save session info
write_lines(capture.output(sessionInfo()), 
            path = paste0(dir_results, "/sessionInfo.txt"))
```
